{"ast":null,"code":"import _slicedToArray from \"/Users/kimkiwoong/SonGil/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\n/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n// tslint:disable-next-line: no-imports-from-dist\nimport * as tfOps from '@tensorflow/tfjs-core/dist/ops/ops_for_converter';\nimport { getPadding, getParamValue } from './utils';\n\nfunction fusedConvAndDepthWiseParams(node, tensorMap, context) {\n  var _getParamValue = getParamValue('fusedOps', node, tensorMap, context),\n      _getParamValue2 = _slicedToArray(_getParamValue, 2),\n      extraOp = _getParamValue2[0],\n      activationFunc = _getParamValue2[1];\n\n  var isBiasAdd = extraOp === 'biasadd';\n  var isPrelu = activationFunc === 'prelu';\n  var isBatchNorm = extraOp === 'fusedbatchnorm';\n  var numArgs = getParamValue('numArgs', node, tensorMap, context);\n\n  if (isBiasAdd) {\n    if (isPrelu && numArgs !== 2) {\n      throw new Error('FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu ' + 'must have two extra arguments: bias and alpha.');\n    }\n\n    if (!isPrelu && numArgs !== 1) {\n      throw new Error('FusedConv2d and DepthwiseConv2d with BiasAdd must have ' + 'one extra argument: bias.');\n    }\n  }\n\n  if (isBatchNorm) {\n    throw new Error('FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.');\n  }\n\n  var stride = getParamValue('strides', node, tensorMap, context);\n  var pad = getPadding(node, tensorMap, context);\n  var dataFormat = getParamValue('dataFormat', node, tensorMap, context).toUpperCase();\n  var dilations = getParamValue('dilations', node, tensorMap, context);\n\n  var _getParamValue3 = getParamValue('args', node, tensorMap, context),\n      _getParamValue4 = _slicedToArray(_getParamValue3, 2),\n      biasArg = _getParamValue4[0],\n      preluArg = _getParamValue4[1];\n\n  var leakyreluAlpha = getParamValue('leakyreluAlpha', node, tensorMap, context);\n  return {\n    stride: stride,\n    pad: pad,\n    dataFormat: dataFormat,\n    dilations: dilations,\n    biasArg: biasArg,\n    preluArg: preluArg,\n    activationFunc: activationFunc,\n    leakyreluAlpha: leakyreluAlpha\n  };\n}\n\nexport var executeOp = function executeOp(node, tensorMap, context) {\n  switch (node.op) {\n    case 'Conv1D':\n      {\n        var stride = getParamValue('stride', node, tensorMap, context);\n        var pad = getParamValue('pad', node, tensorMap, context);\n        var dataFormat = getParamValue('dataFormat', node, tensorMap, context).toUpperCase();\n        var dilation = getParamValue('dilation', node, tensorMap, context);\n        return [tfOps.conv1d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), stride, pad, dataFormat, dilation)];\n      }\n\n    case 'Conv2D':\n      {\n        var _stride = getParamValue('strides', node, tensorMap, context);\n\n        var _pad = getPadding(node, tensorMap, context);\n\n        var _dataFormat = getParamValue('dataFormat', node, tensorMap, context).toUpperCase();\n\n        var dilations = getParamValue('dilations', node, tensorMap, context);\n        return [tfOps.conv2d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [_stride[1], _stride[2]], _pad, _dataFormat, [dilations[1], dilations[2]])];\n      }\n\n    case '_FusedConv2D':\n      {\n        var _fusedConvAndDepthWis = fusedConvAndDepthWiseParams(node, tensorMap, context),\n            _stride2 = _fusedConvAndDepthWis.stride,\n            _pad2 = _fusedConvAndDepthWis.pad,\n            _dataFormat2 = _fusedConvAndDepthWis.dataFormat,\n            _dilations = _fusedConvAndDepthWis.dilations,\n            biasArg = _fusedConvAndDepthWis.biasArg,\n            preluArg = _fusedConvAndDepthWis.preluArg,\n            activationFunc = _fusedConvAndDepthWis.activationFunc,\n            leakyreluAlpha = _fusedConvAndDepthWis.leakyreluAlpha;\n\n        return [tfOps.fused.conv2d({\n          x: getParamValue('x', node, tensorMap, context),\n          filter: getParamValue('filter', node, tensorMap, context),\n          strides: [_stride2[1], _stride2[2]],\n          pad: _pad2,\n          dataFormat: _dataFormat2,\n          dilations: [_dilations[1], _dilations[2]],\n          bias: biasArg,\n          activation: activationFunc,\n          preluActivationWeights: preluArg,\n          leakyreluAlpha: leakyreluAlpha\n        })];\n      }\n\n    case 'FusedDepthwiseConv2dNative':\n      {\n        var _fusedConvAndDepthWis2 = fusedConvAndDepthWiseParams(node, tensorMap, context),\n            _stride3 = _fusedConvAndDepthWis2.stride,\n            _pad3 = _fusedConvAndDepthWis2.pad,\n            _dataFormat3 = _fusedConvAndDepthWis2.dataFormat,\n            _dilations2 = _fusedConvAndDepthWis2.dilations,\n            _biasArg = _fusedConvAndDepthWis2.biasArg,\n            _preluArg = _fusedConvAndDepthWis2.preluArg,\n            _activationFunc = _fusedConvAndDepthWis2.activationFunc,\n            _leakyreluAlpha = _fusedConvAndDepthWis2.leakyreluAlpha;\n\n        return [tfOps.fused.depthwiseConv2d({\n          x: getParamValue('x', node, tensorMap, context),\n          filter: getParamValue('filter', node, tensorMap, context),\n          strides: [_stride3[1], _stride3[2]],\n          pad: _pad3,\n          dataFormat: _dataFormat3,\n          dilations: [_dilations2[1], _dilations2[2]],\n          bias: _biasArg,\n          activation: _activationFunc,\n          preluActivationWeights: _preluArg,\n          leakyreluAlpha: _leakyreluAlpha\n        })];\n      }\n\n    case 'Conv2DBackpropInput':\n    case 'Conv2dTranspose':\n      {\n        var shape = getParamValue('outputShape', node, tensorMap, context);\n\n        var _stride4 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad4 = getPadding(node, tensorMap, context);\n\n        return [tfOps.conv2dTranspose(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), shape, [_stride4[1], _stride4[2]], _pad4)];\n      }\n\n    case 'DepthwiseConv2dNative':\n    case 'DepthwiseConv2d':\n      {\n        var _stride5 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad5 = getPadding(node, tensorMap, context);\n\n        var _dilations3 = getParamValue('dilations', node, tensorMap, context);\n\n        var _dataFormat4 = getParamValue('dataFormat', node, tensorMap, context).toUpperCase();\n\n        return [tfOps.depthwiseConv2d(getParamValue('input', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [_stride5[1], _stride5[2]], _pad5, _dataFormat4, [_dilations3[1], _dilations3[2]])];\n      }\n\n    case 'Conv3D':\n      {\n        var _stride6 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad6 = getParamValue('pad', node, tensorMap, context);\n\n        var _dataFormat5 = getParamValue('dataFormat', node, tensorMap, context).toUpperCase();\n\n        var _dilations4 = getParamValue('dilations', node, tensorMap, context);\n\n        return [tfOps.conv3d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [_stride6[1], _stride6[2], _stride6[3]], _pad6, _dataFormat5, [_dilations4[1], _dilations4[2], _dilations4[3]])];\n      }\n\n    case 'AvgPool':\n      {\n        var _stride7 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad7 = getParamValue('pad', node, tensorMap, context);\n\n        var kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n        return [tfOps.avgPool(getParamValue('x', node, tensorMap, context), [kernelSize[1], kernelSize[2]], [_stride7[1], _stride7[2]], _pad7)];\n      }\n\n    case 'MaxPool':\n      {\n        var _stride8 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad8 = getParamValue('pad', node, tensorMap, context);\n\n        var _kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n\n        return [tfOps.maxPool(getParamValue('x', node, tensorMap, context), [_kernelSize[1], _kernelSize[2]], [_stride8[1], _stride8[2]], _pad8)];\n      }\n\n    case 'MaxPoolWithArgmax':\n      {\n        var _stride9 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad9 = getParamValue('pad', node, tensorMap, context);\n\n        var _kernelSize2 = getParamValue('kernelSize', node, tensorMap, context);\n\n        var includeBatchInIndex = getParamValue('includeBatchInIndex', node, tensorMap, context);\n\n        var _tfOps$maxPoolWithArg = tfOps.maxPoolWithArgmax(getParamValue('x', node, tensorMap, context), [_kernelSize2[1], _kernelSize2[2]], [_stride9[1], _stride9[2]], _pad9, includeBatchInIndex),\n            result = _tfOps$maxPoolWithArg.result,\n            indexes = _tfOps$maxPoolWithArg.indexes;\n\n        return [result, indexes];\n      }\n\n    case 'AvgPool3D':\n      {\n        var _stride10 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad10 = getParamValue('pad', node, tensorMap, context);\n\n        var _kernelSize3 = getParamValue('kernelSize', node, tensorMap, context);\n\n        return [tfOps.avgPool3d(getParamValue('x', node, tensorMap, context), [_kernelSize3[1], _kernelSize3[2], _kernelSize3[3]], [_stride10[1], _stride10[2], _stride10[3]], _pad10)];\n      }\n\n    case 'MaxPool3D':\n      {\n        var _stride11 = getParamValue('strides', node, tensorMap, context);\n\n        var _pad11 = getParamValue('pad', node, tensorMap, context);\n\n        var _kernelSize4 = getParamValue('kernelSize', node, tensorMap, context);\n\n        return [tfOps.maxPool3d(getParamValue('x', node, tensorMap, context), [_kernelSize4[1], _kernelSize4[2], _kernelSize4[3]], [_stride11[1], _stride11[2], _stride11[3]], _pad11)];\n      }\n\n    case 'Dilation2D':\n      {\n        var strides = getParamValue('strides', node, tensorMap, context);\n\n        var _pad12 = getParamValue('pad', node, tensorMap, context);\n\n        var _dilations5 = getParamValue('dilations', node, tensorMap, context); // strides: [1, stride_height, stride_width, 1].\n\n\n        var strideHeight = strides[1];\n        var strideWidth = strides[2]; // dilations: [1, dilation_height, dilation_width, 1].\n\n        var dilationHeight = _dilations5[1];\n        var dilationWidth = _dilations5[2];\n        return [tfOps.dilation2d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [strideHeight, strideWidth], _pad12, [dilationHeight, dilationWidth], 'NHWC'\n        /* dataFormat */\n        )];\n      }\n\n    default:\n      throw TypeError(\"Node type \".concat(node.op, \" is not implemented\"));\n  }\n};\nexport var CATEGORY = 'convolution';","map":{"version":3,"sources":["../../../src/operations/executors/convolution_executor.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n// tslint:disable-next-line: no-imports-from-dist\nimport * as tfOps from '@tensorflow/tfjs-core/dist/ops/ops_for_converter';\nimport { getPadding, getParamValue } from './utils';\nfunction fusedConvAndDepthWiseParams(node, tensorMap, context) {\n    const [extraOp, activationFunc] = getParamValue('fusedOps', node, tensorMap, context);\n    const isBiasAdd = extraOp === 'biasadd';\n    const isPrelu = activationFunc === 'prelu';\n    const isBatchNorm = extraOp === 'fusedbatchnorm';\n    const numArgs = getParamValue('numArgs', node, tensorMap, context);\n    if (isBiasAdd) {\n        if (isPrelu && numArgs !== 2) {\n            throw new Error('FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu ' +\n                'must have two extra arguments: bias and alpha.');\n        }\n        if (!isPrelu && numArgs !== 1) {\n            throw new Error('FusedConv2d and DepthwiseConv2d with BiasAdd must have ' +\n                'one extra argument: bias.');\n        }\n    }\n    if (isBatchNorm) {\n        throw new Error('FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.');\n    }\n    const stride = getParamValue('strides', node, tensorMap, context);\n    const pad = getPadding(node, tensorMap, context);\n    const dataFormat = getParamValue('dataFormat', node, tensorMap, context)\n        .toUpperCase();\n    const dilations = getParamValue('dilations', node, tensorMap, context);\n    const [biasArg, preluArg] = getParamValue('args', node, tensorMap, context);\n    const leakyreluAlpha = getParamValue('leakyreluAlpha', node, tensorMap, context);\n    return {\n        stride,\n        pad,\n        dataFormat,\n        dilations,\n        biasArg,\n        preluArg,\n        activationFunc,\n        leakyreluAlpha\n    };\n}\nexport const executeOp = (node, tensorMap, context) => {\n    switch (node.op) {\n        case 'Conv1D': {\n            const stride = getParamValue('stride', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const dataFormat = getParamValue('dataFormat', node, tensorMap, context)\n                .toUpperCase();\n            const dilation = getParamValue('dilation', node, tensorMap, context);\n            return [tfOps.conv1d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), stride, pad, dataFormat, dilation)];\n        }\n        case 'Conv2D': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getPadding(node, tensorMap, context);\n            const dataFormat = getParamValue('dataFormat', node, tensorMap, context)\n                .toUpperCase();\n            const dilations = getParamValue('dilations', node, tensorMap, context);\n            return [tfOps.conv2d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [stride[1], stride[2]], pad, dataFormat, [dilations[1], dilations[2]])];\n        }\n        case '_FusedConv2D': {\n            const { stride, pad, dataFormat, dilations, biasArg, preluArg, activationFunc, leakyreluAlpha } = fusedConvAndDepthWiseParams(node, tensorMap, context);\n            return [tfOps.fused.conv2d({\n                    x: getParamValue('x', node, tensorMap, context),\n                    filter: getParamValue('filter', node, tensorMap, context),\n                    strides: [stride[1], stride[2]],\n                    pad: pad,\n                    dataFormat: dataFormat,\n                    dilations: [dilations[1], dilations[2]],\n                    bias: biasArg,\n                    activation: activationFunc,\n                    preluActivationWeights: preluArg,\n                    leakyreluAlpha\n                })];\n        }\n        case 'FusedDepthwiseConv2dNative': {\n            const { stride, pad, dataFormat, dilations, biasArg, preluArg, activationFunc, leakyreluAlpha, } = fusedConvAndDepthWiseParams(node, tensorMap, context);\n            return [tfOps.fused.depthwiseConv2d({\n                    x: getParamValue('x', node, tensorMap, context),\n                    filter: getParamValue('filter', node, tensorMap, context),\n                    strides: [stride[1], stride[2]],\n                    pad: pad,\n                    dataFormat: dataFormat,\n                    dilations: [dilations[1], dilations[2]],\n                    bias: biasArg,\n                    activation: activationFunc,\n                    preluActivationWeights: preluArg,\n                    leakyreluAlpha\n                })];\n        }\n        case 'Conv2DBackpropInput':\n        case 'Conv2dTranspose': {\n            const shape = getParamValue('outputShape', node, tensorMap, context);\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getPadding(node, tensorMap, context);\n            return [tfOps.conv2dTranspose(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), shape, [stride[1], stride[2]], pad)];\n        }\n        case 'DepthwiseConv2dNative':\n        case 'DepthwiseConv2d': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getPadding(node, tensorMap, context);\n            const dilations = getParamValue('dilations', node, tensorMap, context);\n            const dataFormat = getParamValue('dataFormat', node, tensorMap, context)\n                .toUpperCase();\n            return [tfOps.depthwiseConv2d(getParamValue('input', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [stride[1], stride[2]], pad, dataFormat, [dilations[1], dilations[2]])];\n        }\n        case 'Conv3D': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const dataFormat = getParamValue('dataFormat', node, tensorMap, context)\n                .toUpperCase();\n            const dilations = getParamValue('dilations', node, tensorMap, context);\n            return [tfOps.conv3d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [stride[1], stride[2], stride[3]], pad, dataFormat, [dilations[1], dilations[2], dilations[3]])];\n        }\n        case 'AvgPool': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n            return [tfOps.avgPool(getParamValue('x', node, tensorMap, context), [kernelSize[1], kernelSize[2]], [stride[1], stride[2]], pad)];\n        }\n        case 'MaxPool': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n            return [tfOps.maxPool(getParamValue('x', node, tensorMap, context), [kernelSize[1], kernelSize[2]], [stride[1], stride[2]], pad)];\n        }\n        case 'MaxPoolWithArgmax': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n            const includeBatchInIndex = getParamValue('includeBatchInIndex', node, tensorMap, context);\n            const { result, indexes } = tfOps.maxPoolWithArgmax(getParamValue('x', node, tensorMap, context), [kernelSize[1], kernelSize[2]], [stride[1], stride[2]], pad, includeBatchInIndex);\n            return [result, indexes];\n        }\n        case 'AvgPool3D': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n            return [tfOps.avgPool3d(getParamValue('x', node, tensorMap, context), [kernelSize[1], kernelSize[2], kernelSize[3]], [stride[1], stride[2], stride[3]], pad)];\n        }\n        case 'MaxPool3D': {\n            const stride = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const kernelSize = getParamValue('kernelSize', node, tensorMap, context);\n            return [tfOps.maxPool3d(getParamValue('x', node, tensorMap, context), [kernelSize[1], kernelSize[2], kernelSize[3]], [stride[1], stride[2], stride[3]], pad)];\n        }\n        case 'Dilation2D': {\n            const strides = getParamValue('strides', node, tensorMap, context);\n            const pad = getParamValue('pad', node, tensorMap, context);\n            const dilations = getParamValue('dilations', node, tensorMap, context);\n            // strides: [1, stride_height, stride_width, 1].\n            const strideHeight = strides[1];\n            const strideWidth = strides[2];\n            // dilations: [1, dilation_height, dilation_width, 1].\n            const dilationHeight = dilations[1];\n            const dilationWidth = dilations[2];\n            return [tfOps.dilation2d(getParamValue('x', node, tensorMap, context), getParamValue('filter', node, tensorMap, context), [strideHeight, strideWidth], pad, [dilationHeight, dilationWidth], 'NHWC' /* dataFormat */)];\n        }\n        default:\n            throw TypeError(`Node type ${node.op} is not implemented`);\n    }\n};\nexport const CATEGORY = 'convolution';\n//# sourceMappingURL=convolution_executor.js.map"]},"metadata":{},"sourceType":"module"}